<!DOCTYPE html>
<html lang="cs">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark light">
  <title>Kalkulačka projektové dokumentace (PD) — v1.2.0</title>

  <link rel="stylesheet" href="style.css">

</head>

<body>
  <div class="container">
    <div class="card">
      <h1>Kalkulačka projektové dokumentace (PD)</h1>
      <p class="sub">Orientační výpočet ceny PD. Nyní s odhadem CIS z parametrů FVE/BESS a UNIKA sazbami.</p>

      <div class="grid">
        <section class="card">
          <div class="inline-options">
            <div class="switch">
              <input type="radio" name="cisMode" id="cisModeModel" value="model" checked>
              <label for="cisModeModel">Odhad CIS z FVE/BESS</label>
            </div>
            <div class="switch">
              <input type="radio" name="cisMode" id="cisModeManual" value="manual">
              <label for="cisModeManual">Zadat CIS ručně</label>
            </div>
          </div>

          <div id="modelBlock" style="margin-top:12px;">
            <div class="row">
              <div>
                <label for="fveKwp">FVE výkon (kWp)</label>
                <input id="fveKwp" type="number" inputmode="decimal" min="0" step="0.1" placeholder="např. 500" />
              </div>
              <div>
                <label for="bessKwh">BESS kapacita (kWh)</label>
                <input id="bessKwh" type="number" inputmode="decimal" min="0" step="0.1" placeholder="např. 1200" />
              </div>
            </div>
            <div class="row" style="margin-top:12px;">
              <div>
                <label for="balancePct">Rezerva na balance-of-plant (%)</label>
                <input id="balancePct" type="number" inputmode="decimal" min="0" step="0.5" value="0" />
              </div>
            </div>

            <details style="margin-top:12px;">
              <summary>Jednotkové ceny (řízeno Typem stavby)</summary>
              <div class="row" style="margin-top:12px;">
                <div>
                  <label for="cFveFixed">FVE fixní část (Kč)</label>
                  <input id="cFveFixed" type="number" inputmode="numeric" min="0" step="50000" />
                </div>
                <div>
                  <label for="cFveKwpVar">FVE variabilní (Kč/kWp)</label>
                  <input id="cFveKwpVar" type="number" inputmode="numeric" min="0" step="100" />
                </div>
              </div>
              <div class="row" style="margin-top:12px;">
                <div>
                  <label for="cBessFixed">BESS fixní část (Kč)</label>
                  <input id="cBessFixed" type="number" inputmode="numeric" min="0" step="50000" />
                </div>
                <div>
                  <label for="cBessKwh">BESS variabilní (Kč/kWh)</label>
                  <input id="cBessKwh" type="number" inputmode="numeric" min="0" step="50" />
                </div>
              </div>
              <div class="muted" style="margin-top:6px">Pozn.: FVE i BESS jsou modelovány jako fixní část + variabilní
                cena za jednotku (kWp/kWh). Výchozí hodnoty se načítají dle Typu stavby.</div>
            </details>
          </div>

          <div id="manualBlock" style="display:none;margin-top:12px;">
            <div class="row">
              <div>
                <label for="cis">Celkové investiční náklady (CIS) – Kč (bez DPH)</label>
                <input id="cis" type="number" inputmode="numeric" min="0" step="1000" placeholder="např. 10000000" />
              </div>
              <div>
                <label for="type">Typ stavby</label>
                <div class="stack">
                  <select id="type"></select>
                  <button class="btn" id="addType">+ Nový typ</button>
                </div>
              </div>
            </div>
          </div>

          <div class="row" style="margin-top:12px;">
            <div>
              <label for="type2">Typ stavby</label>
              <div class="stack">
                <select id="type2"></select>
                <button class="btn" id="addType2">+ Nový typ</button>
              </div>
            </div>
            <div>
              <label for="coef">Složitost / náročnost (koeficient)</label>
              <input id="coef" type="number" inputmode="decimal" step="0.05" min="0.5" max="2" value="1" />
              <div class="muted">0,8 = jednodušší | 1,0 = běžná | 1,2 = složitější</div>
            </div>
          </div>

          <div class="row align-start" style="margin-top:12px;">
            <div>
              <label>Hodinová sazba
                <span class="muted">(UNIKA / Vlastní)</span>
              </label>
              <div class="inline-options">
                <div class="switch">
                  <input type="radio" name="rateMode" id="rateUnika" value="unika" checked>
                  <label for="rateUnika">UNIKA</label>
                </div>
                <div class="switch">
                  <input type="radio" name="rateMode" id="rateCustom" value="custom">
                  <label for="rateCustom">Vlastní</label>
                </div>
                <input id="hourlyRate" type="number" inputmode="numeric" min="0" step="50" placeholder="např. 1200"
                  disabled />
              </div>
              <div class="muted">V režimu UNIKA je hodinovka řízena typem stavby (viz konstanty). V režimu Vlastní lze
                přepsat.</div>
            </div>
            <div>
              <label for="hourlyCoef">Koeficient profese
                <span class="help-badge" tabindex="0">?
                  <span class="help-tip">
                    Koeficient násobí hodinovou sazbu podle seniority/typu práce:
                    <br><b>1.0</b> běžná profese,
                    <b>0.8–0.9</b> junior,
                    <b>1.2–1.3</b> senior/HIP,
                    <b>1.4–1.6</b> specialista,
                    <b>1.5–2.0</b> expresní termín.
                    <br>Vyšší koeficient ⇒ menší hodinový limit (při stejné ceně z %).
                  </span>
                </span>
              </label>
              <input id="hourlyCoef" type="number" inputmode="decimal" step="0.05" min="0.5" max="2" value="1" />
              <div class="muted">viz: help-tip (?)</div>
            </div>
          </div>

          <div class="hr"></div>

          <details>
            <summary>Procenta podle stupňů PD (upravte dle potřeby)</summary>
            <table class="table" id="stagesTable">
              <thead>
                <tr>
                  <th>Stupeň</th>
                  <th class="right">Podíl z CIS (%)</th>
                  <th class="right">Zahrnout</th>
                </tr>
              </thead>
              <tbody id="stagesBody"></tbody>
            </table>
            <div class="footnote">Tip: Procenta jsou výchozí pro zvolený typ, ale můžete je kdykoli přepsat. Tlačítkem
              níže je uložíte jako výchozí.</div>
          </details>

          <div class="hr"></div>

          <div class="stack">
            <button class="btn primary" id="calculate">Spočítat</button>
            <button class="btn" id="printOffer">Tisk / PDF nabídka</button>
            <button class="btn" id="saveDefaults">Uložit nastavení k typu</button>
            <button class="btn" id="resetConfig">Obnovit výchozí</button>
            <span class="notice">Výsledky se přepočítávají průběžně.</span>
          </div>
        </section>

        <section class="card">
          <h3 style="margin-top:0">Výsledky</h3>

          <div class="kpi">
            <div class="item">
              <div class="muted">CIS (bez DPH)</div>
              <div class="value" id="kpiCis">–</div>
              <div class="muted" id="kpiCisNote"></div>
            </div>
            <div class="item">
              <div class="muted">Koeficient × rezerva</div>
              <div class="value" id="kpiCoef">–</div>
            </div>
            <div class="item">
              <div class="muted">Celkem PD (součet)</div>
              <div class="value" id="kpiTotal">–</div>
            </div>
          </div>
          <div id="calcWarning" class="muted"
            style="color: var(--warn); margin-top: 8px; text-align: center; display: none; font-weight: 600;">

          </div>

          <table class="table" style="margin-top:16px;" id="resultTable">
            <thead>
              <tr>
                <th>Stupeň</th>
                <th class="right nowrap">% z CIS</th>
                <th class="right nowrap">Cena % (Kč)</th>
                <th class="right nowrap">Hodinový limit (h)</th>
              </tr>
            </thead>
            <tbody id="resultBody"></tbody>
            <tfoot>
              <tr>
                <th class="right" colspan="2">Součet</th>
                <th class="right total" id="resultSum">–</th>
                <th class="right total" id="resultHours">–</th>
              </tr>
            </tfoot>
          </table>

          <div class="hr"></div>

          <div class="muted">
            Pozn.: Jde o orientační odhad dle procenta z CIS. Skutečná cena závisí na rozsahu, BIM koordinaci, termínech
            apod.
          </div>
        </section>
      </div>
    </div>
  </div>

  <template id="typeDialogTpl">
    <div class="card"
      style="position:fixed; inset:0; margin:auto; width:min(560px,92vw); height:auto; z-index:50; border:1px solid #334155;">
      <h3 style="margin-top:0">Přidat nový typ stavby</h3>
      <div class="row">
        <div>
          <label>Název typu</label>
          <input id="newTypeName" placeholder="např. Administrativní budova" />
        </div>
      </div>
      <div class="hr"></div>
      <div>
        <label>Výchozí procenta pro stupně</label>
        <table class="table">
          <thead>
            <tr>
              <th>Stupeň</th>
              <th class="right">% z CIS</th>
            </tr>
          </thead>
          <tbody id="newTypePerc"></tbody>
        </table>
      </div>
      <div class="hr"></div>
      <div class="stack" style="justify-content:flex-end;">
        <button class="btn ghost" id="cancelType">Zrušit</button>
        <button class="btn primary" id="confirmType">Přidat typ</button>
      </div>
    </div>
  </template>

  <footer style="margin-top:40px; text-align:center; font-size:12px; color:#94a3b8;">
    <span id="appVer"></span> – ©Nolzak <span id="year"></span> PD kalkulačka
  </footer>

  <script src="script.js"></script>
</body>

</html>