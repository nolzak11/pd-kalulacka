<!DOCTYPE html>
<html lang="cs">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="dark light">
  <title>Kalkulačka PD (v1.3.0)</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>
  <div class="container">
    <div class="card">
      <h1>Kalkulačka projektové dokumentace FVE + BESS (PD)</h1>
      <p class="sub">Orientační výpočet ceny PD dle parametrů FVE/BESS nebo ručního zadání investice.</p>

      <div class="grid">
        <section class="card">

          <div class="row">
            <div>
              <label for="projectType">1. Typ stavby</label>
              <div class="stack">
                <select id="projectType" class="input-primary"></select>
                <button class="btn" id="addType">+ Nový typ</button>
              </div>
            </div>
            <div>
              <label>2. Způsob výpočtu investice</label>
              <div class="inline-options" style="padding-top: 8px;">
                <div class="switch">
                  <input type="radio" name="cisMode" id="cisModeModel" value="model" checked>
                  <label for="cisModeModel">Odhad z FVE/BESS</label>
                </div>
                <div class="switch">
                  <input type="radio" name="cisMode" id="cisModeManual" value="manual">
                  <label for="cisModeManual">Zadat celkovou investici ručně</label>
                </div>
              </div>
            </div>
          </div>
          <div class="hr"></div>

          <div id="modelBlock">
            <label>3. Základní parametry modelu</label>
            <div class="row" style="margin-top:6px;">
              <div>
                <input id="fveKwp" type="number" inputmode="decimal" min="0" step="0.1" placeholder="FVE výkon (kWp)"
                  class="input-primary" />
              </div>
              <div>
                <input id="bessKwh" type="number" inputmode="decimal" min="0" step="0.1"
                  placeholder="BESS kapacita (kWh)" class="input-primary" />
              </div>
            </div>
          </div>

          <div id="manualBlock" style="display:none;">
            <label>3. Ruční zadání investice</label>
            <div style="margin-top:6px;">
              <input id="cis" type="number" inputmode="numeric" min="0" step="1000" placeholder="Celková investice (Kč)"
                class="input-primary" />
            </div>
          </div>
          <div class="hr" style="margin: 24px 0;"></div>

          <div class="row align-start" style="margin-top:12px;">
            <div>
              <label>4. Hodinová sazba <span class="muted">(UNIKA / Vlastní)</span></label>
              <div class="inline-options">
                <div class="switch">
                  <input type="radio" name="rateMode" id="rateUnika" value="unika" checked>
                  <label for="rateUnika">UNIKA</label>
                </div>
                <div class="switch">
                  <input type="radio" name="rateMode" id="rateCustom" value="custom">
                  <label for="rateCustom">Vlastní</label>
                </div>
                <input id="hourlyRate" type="number" inputmode="numeric" min="0" step="50" placeholder="např. 1200"
                  disabled />
              </div>
            </div>
          </div>

          <details class="settings-group">
            <summary>Pokročilé nastavení: Koeficienty a sazby</summary>
            <div class="row" style="margin-top:12px;">
              <div>
                <label for="coef">Složitost / náročnost (koeficient)
                  <span class="help-badge" tabindex="0">?
                    <span class="help-tip">
                      Koeficient zohledňuje náročnost práce - výchozí je 1,0.
                      <br>0,8 = jednodušší, 1,0 = běžná, 1,2–1,5 = složitější, 1,6–2,0 = vysoce náročná.  

                    </span>
                  </span>
                </label>
                <input id="coef" type="number" inputmode="decimal" step="0.05" min="0.5" max="2" value="1" />
                </div>
              <div>
                <label for="hourlyCoef">Koeficient profese
                  <span class="help-badge" tabindex="0">?
                    <span class="help-tip">
                      Koeficient násobí hodinovou sazbu podle seniority/typu práce:
                      <br><b>1.0</b> běžná profese, <b>0.8–0.9</b> junior, <b>1.2–1.3</b> senior/HIP...
                    </span>
                  </span>
                </label>
                <input id="hourlyCoef" type="number" inputmode="decimal" step="0.05" min="0.5" max="2" value="1" />
              </div>
              <div class="row" style="margin-top:12px;">
                <div>
                  <label for="balancePct">Ostatní náklady a rezerva (%)
                    <span class="help-badge" tabindex="0">?
                      <span class="help-tip">
                        Procentuální navýšení základní ceny FVE a BESS o vedlejší náklady.<br>
                        Zahrnuje např.: kabeláž, nosné konstrukce, zemní práce, administrativa, rezerva projektu...
                      </span>
                    </span>
                  </label>
                  <input id="balancePct" type="number" inputmode="decimal" min="0" step="0.5" value="0" />
                </div>
              </div>
            </div>

          </details>
          <details class="settings-group">
            <summary>Pokročilé nastavení: Rozdělení rozpočtu PD (poměry)</summary>
            <table class="table" id="stagesTable">
              <thead>
                <tr>
                  <th>Stupeň</th>
                  <th class="right">Poměr (díl)</th>
                  <th class="right">Zahrnout</th>
                </tr>
              </thead>
              <tbody id="stagesBody"></tbody>
              <tfoot>
                <tr>
                  <td colspan="3" class="ratio-summary">
                    Součet poměrů (zaškrtnutých): <span id="stagesTotalRatio">0.0</span>
                  </td>
                </tr>
              </tfoot>
            </table>
          </details>

          <div class="hr" style="margin-top: 20px;"></div>

          <div class="stack">
            <button class="btn primary" id="calculate">Spočítat</button>
            <button class="btn" id="printOffer">Tisk / PDF nabídka</button>
            <button class="btn" id="saveDefaults">Uložit poměry, ceny & sazby</button>
            <button class="btn" id="resetConfig">Obnovit výchozí</button>
            <span class="notice">Výsledky se přepočítávají průběžně.</span>
          </div>
        </section>

        <section class="card">
          <h3 style="margin-top:0">Výsledky</h3>

          <div class="kpi">
            <div class="item">
              <div class="muted">Odhad investice (bez DPH)</div>
              <div class="value" id="kpiInvestment">–</div>
              <div class="muted" id="kpiInvestmentNote"></div>
            </div>
            <div class="item">
              <div class="muted">Celkový rozpočet PD</div>
              <div class="value" id="kpiTotal" style="color: var(--ok);">–</div>
              <div class="muted" id="kpiTotalNote"></div>
            </div>
            <div class="item">
              <div class="muted">Hodinová sazba</div>
              <div class="value" id="kpiHourlyRate">–</div>
              <div class="muted" id="kpiHourlyRateNote"></div>
            </div>
          </div>

          <div id="calcWarning" class="muted"
            style="color: var(--warn); margin-top: 8px; text-align: center; display: none; font-weight: 600;">
          </div>

          <table class="table" style="margin-top:16px;" id="resultTable">
            <thead>
              <tr>
                <th>Stupeň</th>
                <th class="right nowrap">Poměr (díl)</th>
                <th class="right nowrap">Cena (Kč)</th>
                <th class="right nowrap">Hodinový limit (h)</th>
              </tr>
            </thead>
            <tbody id="resultBody"></tbody>
            <tfoot>
              <tr>
                <th class="right" colspan="2">Součet</th>
                <th class="right total" id="resultSum">–</th>
                <th class="right total" id="resultHours">–</th>
              </tr>
            </tfoot>
          </table>

          <div class="hr"></div>

          <div class="muted">
            Pozn.: Jde o orientační odhad. Cena je rozdělena dle poměrů a vynásobena koeficientem složitosti.
          </div>
        </section>
      </div>
    </div>
  </div>

  <template id="typeDialogTpl">
    <div class="card"
      style="position:fixed; inset:0; margin:auto; width:min(560px,92vw); height:auto; z-index:50; border:1px solid #334155;">
      <h3 style="margin-top:0">Přidat nový typ stavby</h3>
      <div class="row">
        <div>
          <label>Název typu</label>
          <input id="newTypeName" placeholder="např. Administrativní budova" />
        </div>
      </div>
      <div class="hr"></div>
      <div>
        <label>Výchozí poměry pro stupně</label>
        <table class="table">
          <thead>
            <tr>
              <th>Stupeň</th>
              <th class="right">Poměr (díl)</th>
            </tr>
          </thead>
          <tbody id="newTypePerc"></tbody>
        </table>
      </div>
      <div class="hr"></div>
      <div class="stack" style="justify-content:flex-end;">
        <button class="btn ghost" id="cancelType">Zrušit</button>
        <button class="btn primary" id="confirmType">Přidat typ</button>
      </div>
    </div>
  </template>

  <footer style="margin-top:40px; text-align:center; font-size:12px; color:#94a3b8;">
    <span id="appVer"></span> – ©Nolzak <span id="year"></span> PD kalkulačka
  </footer>

  <script src="script.js"></script>
</body>


</html>
